<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Tracker - JobSaathi</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="assets/css/index.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="brand">
                <span>üöÄ</span> JobSaathi
            </div>

            <nav>
                <a href="dashboard.html" class="nav-item">
                    <span class="nav-icon">üìä</span> Dashboard
                </a>
                <a href="jobs.html" class="nav-item">
                    <span class="nav-icon">üíº</span> Job Matches
                </a>
                <a href="tracker.html" class="nav-item active">
                    <span class="nav-icon">üìå</span> Tracker
                </a>
                <div style="margin: 20px 0; border-top: 1px solid #E2E8F0;"></div>
                <div class="text-gray text-sm font-bold mb-2 px-4">AI TOOLS</div>
                <a href="chat.html" class="nav-item">
                    <span class="nav-icon">ü§ñ</span> Orion Coach
                </a>
                <a href="ats-checker.html" class="nav-item">
                    <span class="nav-icon">üìù</span> ATS Checker
                </a>
                <a href="skills.html" class="nav-item">
                    <span class="nav-icon">üß†</span> Skill Advisor
                </a>
                <a href="interview.html" class="nav-item">
                    <span class="nav-icon">üé§</span> Interview Prep
                </a>
                <a href="salary.html" class="nav-item">
                    <span class="nav-icon">üí∞</span> Salary Predictor
                </a>
                <div style="margin: 20px 0; border-top: 1px solid #E2E8F0;"></div>
                <a href="pricing.html" class="nav-item">
                    <span class="nav-icon">üíé</span> Premium
                </a>
                <a href="settings.html" class="nav-item">
                    <span class="nav-icon">‚öôÔ∏è</span> Settings
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="mb-8 flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold mb-2">Application Tracker</h1>
                    <p class="text-gray">Track and manage your job applications.</p>
                </div>
                <button class="btn btn-primary" onclick="addApplication()">+ Add Manual Entry</button>
            </header>

            <!-- Stats -->
            <div class="grid grid-cols-4 gap-6 mb-8">
                <div class="card stat-card">
                    <span class="stat-label">Total Sent</span>
                    <span class="stat-value">127</span>
                </div>
                <div class="card stat-card">
                    <span class="stat-label">In Review</span>
                    <span class="stat-value">23</span>
                    <span class="text-warning text-sm">Active</span>
                </div>
                <div class="card stat-card">
                    <span class="stat-label">Interviews</span>
                    <span class="stat-value">8</span>
                    <span class="text-primary text-sm">Next: Tomorrow</span>
                </div>
                <div class="card stat-card">
                    <span class="stat-label">Offers</span>
                    <span class="stat-value">2</span>
                    <span class="text-success text-sm">Action Required</span>
                </div>
            </div>

            <!-- Applications Table -->
            <div class="card">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Recent Applications</h2>
                    <div class="flex gap-2">
                        <select class="p-2 border rounded-lg text-sm">
                            <option>All Statuses</option>
                            <option>Applied</option>
                            <option>Interview</option>
                            <option>Offer</option>
                        </select>
                        <input type="text" placeholder="Search..." class="p-2 border rounded-lg text-sm">
                    </div>
                </div>

                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 2px solid #E2E8F0;">
                            <th class="p-3 text-gray text-sm">Company</th>
                            <th class="p-3 text-gray text-sm">Role</th>
                            <th class="p-3 text-gray text-sm">Date Applied</th>
                            <th class="p-3 text-gray text-sm">Status</th>
                            <th class="p-3 text-gray text-sm">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="applicationsTable">
                        <!-- Populated by JS -->
                        <tr>
                            <td colspan="5" class="text-center p-4">Loading applications...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script src="assets/js/app.js"></script>
    <script>
        async function loadApplications() {
            try {
                const response = await fetch('http://localhost:3000/api/applications');
                const data = await response.json();
                renderTable(data.applications);
                updateStats(data.applications);
            } catch (error) {
                console.error('Error loading applications:', error);
            }
        }

        function renderTable(apps) {
            const tbody = document.getElementById('applicationsTable');
            if (apps.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center p-4">No applications found.</td></tr>';
                return;
            }

            tbody.innerHTML = apps.map(app => `
                <tr style="border-bottom: 1px solid #E2E8F0;">
                    <td class="p-3 font-bold">${app.company}</td>
                    <td class="p-3">${app.role}</td>
                    <td class="p-3 text-gray">${app.date}</td>
                    <td class="p-3"><span class="badge ${getStatusBadge(app.status)}">${app.status}</span></td>
                    <td class="p-3">
                        <button class="btn btn-secondary text-sm py-1 px-2">View</button>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusBadge(status) {
            switch (status.toLowerCase()) {
                case 'interview': return 'badge-match';
                case 'offer': return 'badge-match'; // Green
                case 'rejected': return 'badge-new'; // Red/Gray (using new for now)
                default: return 'badge-new';
            }
        }

        function updateStats(apps) {
            // Logic to update top cards based on data
            // For now, we'll keep the static numbers or update them if needed
        }

        function addApplication() {
            // Simple prompt for now
            const company = prompt("Enter Company Name:");
            if (!company) return;
            const role = prompt("Enter Role:");

            fetch('http://localhost:3000/api/applications', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ company, role, status: 'Applied' })
            }).then(() => loadApplications());
        }

        document.addEventListener('DOMContentLoaded', loadApplications);
    </script>
</body>

</html>